#include "example6.h"

void Example6::Main(int argc UNUSED_PARAM, char *arg[] UNUSED_PARAM)
{
    Example6 e;
    e.method1K4();
}

Example6::Example6()
{
}

double Example6::a(unsigned int i, unsigned int j, unsigned int k UNUSED_PARAM) const
{
    if (i==0 && j==0) return +2.0;
    if (i==0 && j==1) return +3.0;
    if (i==0 && j==2) return -1.0;

    if (i==1 && j==0) return +4.0;
    if (i==1 && j==1) return +6.0;
    if (i==1 && j==2) return -2.0;

    if (i==2 && j==0) return -1.0;
    if (i==2 && j==1) return +1.0;
    if (i==2 && j==2) return -1.0;

    return NAN;
}

double Example6::b(unsigned int i, unsigned int k) const
{
    double t = k*h;

#ifdef SAMPLE_1
    if (i==0) return -(+2.0*sin(20.0*t*t) + 3.0*(cos(10.0*t) - sin(20.0*t)) - 1.0*(t*t*t - sin(8.0*t)*sin(8.0*t))) + (+40.0*t*cos(20.0*t*t));
    if (i==1) return -(+4.0*sin(20.0*t*t) + 6.0*(cos(10.0*t) - sin(20.0*t)) - 2.0*(t*t*t - sin(8.0*t)*sin(8.0*t))) + (-10.0*sin(10.0*t) - 20.0*cos(20.0*t));
    if (i==2) return -(-1.0*sin(20.0*t*t) + 1.0*(cos(10.0*t) - sin(20.0*t)) - 1.0*(t*t*t - sin(8.0*t)*sin(8.0*t))) + (+3.0*t*t - 16.0*cos(8.0*t)*sin(8.0*t));
#endif
#ifdef SAMPLE_2
    if (i==0) return -(+2.0*sin(t*t) + 3.0*(cos(t) - sin(t)) - 1.0*(t*t*t - sin(t)*sin(t))) + (+2.0*t*cos(t*t));
    if (i==1) return -(+4.0*sin(t*t) + 6.0*(cos(t) - sin(t)) - 2.0*(t*t*t - sin(t)*sin(t))) + (-sin(t) - cos(t));
    if (i==2) return -(-1.0*sin(t*t) + 1.0*(cos(t) - sin(t)) - 1.0*(t*t*t - sin(t)*sin(t))) + (+3.0*t*t - 2.0*cos(t)*sin(t));
#endif
    return NAN;
}

double Example6::fx(unsigned int i, unsigned int k) const
{
    double t = k*h;
#ifdef SAMPLE_1
    if (i==0) return sin(20.0*t*t);
    if (i==1) return cos(10.0*t) - sin(20.0*t);
    if (i==2) return t*t*t - sin(8.0*t)*sin(8.0*t);
#endif
#ifdef SAMPLE_2
    if (i==0) return sin(t*t);
    if (i==1) return cos(t) - sin(t);
    if (i==2) return t*t*t - sin(t)*sin(t);
#endif
    return NAN;
}

void Example6::method1K2()
{
    std::vector<unsigned int> s;
    s.push_back(0);
    s.push_back((1*N)/3);
    s.push_back(N/2);
    s.push_back((2*N)/3);
    s.push_back(N);

    DoubleMatrix rx;
    rx.resize(n,N+1);
    for (unsigned int k=0; k<=N; k++)
    {
        rx.at(0,k) = fx(0,k);
        rx.at(1,k) = fx(1,k);
        rx.at(2,k) = fx(2,k);
    }

    /* initializing betta */
    std::vector<DoubleMatrix> betta;
    betta.resize(N+1);
    for (unsigned int i=0; i<=N; i++)
    {
        betta[i].resize(n,n,0.0);
    }

    DoubleVector eta;
    eta.resize(n,0.0);

    for (unsigned int i=0; i<s.size(); i++)
    {
        betta.at(s[i]).at(0,0) = (rand()%100)*0.1-5.0; betta.at(s[i]).at(0,1) = (rand()%100)*0.1-5.0; betta.at(s[i]).at(0,2) = (rand()%100)*0.1-5.0;
        betta.at(s[i]).at(1,0) = (rand()%100)*0.1-5.0; betta.at(s[i]).at(1,1) = (rand()%100)*0.1-5.0; betta.at(s[i]).at(1,2) = (rand()%100)*0.1-5.0;
        betta.at(s[i]).at(2,0) = (rand()%100)*0.1-5.0; betta.at(s[i]).at(2,1) = (rand()%100)*0.1-5.0; betta.at(s[i]).at(2,2) = (rand()%100)*0.1-5.0;

//        IPrinter::print(betta.at(s[i]),n,n);
//        IPrinter::printSeperatorLine();

        eta.at(0) = eta.at(0) + betta.at(s[i]).at(0,0)*rx.at(0,s[i]) + betta.at(s[i]).at(0,1)*rx.at(1,s[i]) + betta.at(s[i]).at(0,2)*rx.at(2,s[i]);
        eta.at(1) = eta.at(1) + betta.at(s[i]).at(1,0)*rx.at(0,s[i]) + betta.at(s[i]).at(1,1)*rx.at(1,s[i]) + betta.at(s[i]).at(1,2)*rx.at(2,s[i]);
        eta.at(2) = eta.at(2) + betta.at(s[i]).at(2,0)*rx.at(0,s[i]) + betta.at(s[i]).at(2,1)*rx.at(1,s[i]) + betta.at(s[i]).at(2,2)*rx.at(2,s[i]);
    }

    unsigned int p = 9;
    DoubleMatrix M(p, p);
    DoubleVector c(p);
    DoubleVector x(p);

    for (unsigned int k=0; k<=N-3; k++)
    {
        DoubleMatrix d0 = betta[k+0];
        DoubleMatrix d1 = betta[k+1];
        DoubleMatrix d2 = betta[k+2];

        /************************************************** betta k+1 **************************************************/
        /* first row */
        betta[k+1].at(0,0) = -2.0*h*(d0.at(0,0)*a(0,0,k+1) + d0.at(0,1)*a(1,0,k+1) + d0.at(0,2)*a(2,0,k+1)) + d1.at(0,0);
        betta[k+1].at(0,1) = -2.0*h*(d0.at(0,0)*a(0,1,k+1) + d0.at(0,1)*a(1,1,k+1) + d0.at(0,2)*a(2,1,k+1)) + d1.at(0,1);
        betta[k+1].at(0,2) = -2.0*h*(d0.at(0,0)*a(0,2,k+1) + d0.at(0,1)*a(1,2,k+1) + d0.at(0,2)*a(2,2,k+1)) + d1.at(0,2);

        /* second row */
        betta[k+1].at(1,0) = -2.0*h*(d0.at(1,0)*a(0,0,k+1) + d0.at(1,1)*a(1,0,k+1) + d0.at(1,2)*a(2,0,k+1)) + d1.at(1,0);
        betta[k+1].at(1,1) = -2.0*h*(d0.at(1,0)*a(0,1,k+1) + d0.at(1,1)*a(1,1,k+1) + d0.at(1,2)*a(2,1,k+1)) + d1.at(1,1);
        betta[k+1].at(1,2) = -2.0*h*(d0.at(1,0)*a(0,2,k+1) + d0.at(1,1)*a(1,2,k+1) + d0.at(1,2)*a(2,2,k+1)) + d1.at(1,2);

        /* third row */
        betta[k+1].at(2,0) = -2.0*h*(d0.at(2,0)*a(0,0,k+1) + d0.at(2,1)*a(1,0,k+1) + d0.at(2,2)*a(2,0,k+1)) + d1.at(2,0);
        betta[k+1].at(2,1) = -2.0*h*(d0.at(2,0)*a(0,1,k+1) + d0.at(2,1)*a(1,1,k+1) + d0.at(2,2)*a(2,1,k+1)) + d1.at(2,1);
        betta[k+1].at(2,2) = -2.0*h*(d0.at(2,0)*a(0,2,k+1) + d0.at(2,1)*a(1,2,k+1) + d0.at(2,2)*a(2,2,k+1)) + d1.at(2,2);

        /************************************************** betta k+2 **************************************************/
        /* first row */
        betta[k+2].at(0,0) = d0.at(0,0) + d2.at(0,0);
        betta[k+2].at(0,1) = d0.at(0,1) + d2.at(0,1);
        betta[k+2].at(0,2) = d0.at(0,2) + d2.at(0,2);

        /* second row */
        betta[k+2].at(1,0) = d0.at(1,0) + d2.at(1,0);
        betta[k+2].at(1,1) = d0.at(1,1) + d2.at(1,1);
        betta[k+2].at(1,2) = d0.at(1,2) + d2.at(1,2);

        /* third row */
        betta[k+2].at(2,0) = d0.at(2,0) + d2.at(2,0);
        betta[k+2].at(2,1) = d0.at(2,1) + d2.at(2,1);
        betta[k+2].at(2,2) = d0.at(2,2) + d2.at(2,2);

        /***************************************************** eta ****************************************************/
        eta.at(0) = eta.at(0) + 2.0*h*(d0.at(0,0)*b(0,k+1) + d0.at(0,1)*b(1,k+1) + d0.at(0,2)*b(2,k+1));
        eta.at(1) = eta.at(1) + 2.0*h*(d0.at(1,0)*b(0,k+1) + d0.at(1,1)*b(1,k+1) + d0.at(1,2)*b(2,k+1));
        eta.at(2) = eta.at(2) + 2.0*h*(d0.at(2,0)*b(0,k+1) + d0.at(2,1)*b(1,k+1) + d0.at(2,2)*b(2,k+1));
    }

//    for (unsigned int i=0; i<=N; i++)
//    {
//        IPrinter::print(betta.at(i),n,n);
//        IPrinter::printSeperatorLine();
//    }

    M[0][0] = betta.at(N-2).at(0,0); M[0][1] = betta.at(N-2).at(0,1); M[0][2] = betta.at(N-2).at(0,2);
    M[0][3] = betta.at(N-1).at(0,0); M[0][4] = betta.at(N-1).at(0,1); M[0][5] = betta.at(N-1).at(0,2);
    M[0][6] = betta.at(N-0).at(0,0); M[0][7] = betta.at(N-0).at(0,1); M[0][8] = betta.at(N-0).at(0,2); c[0] = eta[0];

    M[1][0] = betta.at(N-2).at(1,0); M[1][1] = betta.at(N-2).at(1,1); M[1][2] = betta.at(N-2).at(1,2);
    M[1][3] = betta.at(N-1).at(1,0); M[1][4] = betta.at(N-1).at(1,1); M[1][5] = betta.at(N-1).at(1,2);
    M[1][6] = betta.at(N-0).at(1,0); M[1][7] = betta.at(N-0).at(1,1); M[1][8] = betta.at(N-0).at(1,2); c[1] = eta[1];

    M[2][0] = betta.at(N-2).at(2,0); M[2][1] = betta.at(N-2).at(2,1); M[2][2] = betta.at(N-2).at(2,2);
    M[2][3] = betta.at(N-1).at(2,0); M[2][4] = betta.at(N-1).at(2,1); M[2][5] = betta.at(N-1).at(2,2);
    M[2][6] = betta.at(N-0).at(2,0); M[2][7] = betta.at(N-0).at(2,1); M[2][8] = betta.at(N-0).at(2,2); c[2] = eta[2];

    M[3][0] = -3.0-2.0*h*a(0,0,N-2); M[3][1] = +0.0-2.0*h*a(0,1,N-2); M[3][2] = +0.0-2.0*h*a(0,2,N-2); M[3][3] = +4.0; M[3][4] = +0.0; M[3][5] = +0.0; M[3][6] = -1.0; M[3][7] = +0.0; M[3][8] = +0.0; c[3] = 2.0*h*b(0,N-2);
    M[4][0] = +0.0-2.0*h*a(1,0,N-2); M[4][1] = -3.0-2.0*h*a(1,1,N-2); M[4][2] = +0.0-2.0*h*a(1,2,N-2); M[4][3] = +0.0; M[4][4] = +4.0; M[4][5] = +0.0; M[4][6] = +0.0; M[4][7] = -1.0; M[4][8] = +0.0; c[4] = 2.0*h*b(1,N-2);
    M[5][0] = +0.0-2.0*h*a(2,0,N-2); M[5][1] = +0.0-2.0*h*a(2,1,N-2); M[5][2] = -3.0-2.0*h*a(2,2,N-2); M[5][3] = +0.0; M[5][4] = +0.0; M[5][5] = +4.0; M[5][6] = +0.0; M[5][7] = +0.0; M[5][8] = -1.0; c[5] = 2.0*h*b(2,N-2);

    M[6][0] = +1.0; M[6][1] = +0.0; M[6][2] = +0.0; M[6][3] = -4.0; M[6][4] = +0.0; M[6][5] = +0.0; M[6][6] = +3.0-2.0*h*a(0,0,N-0); M[6][7] = +0.0-2.0*h*a(0,1,N-0); M[6][8] = +0.0-2.0*h*a(0,2,N-0); c[6] = 2.0*h*b(0,N-0);
    M[7][0] = +0.0; M[7][1] = +1.0; M[7][2] = +0.0; M[7][3] = +0.0; M[7][4] = -4.0; M[7][5] = +0.0; M[7][6] = +0.0-2.0*h*a(1,0,N-0); M[7][7] = +3.0-2.0*h*a(1,1,N-0); M[7][8] = +0.0-2.0*h*a(1,2,N-0); c[7] = 2.0*h*b(1,N-0);
    M[8][0] = +0.0; M[8][1] = +0.0; M[8][2] = +1.0; M[8][3] = +0.0; M[8][4] = +0.0; M[8][5] = -4.0; M[8][6] = +0.0-2.0*h*a(2,0,N-0); M[8][7] = +0.0-2.0*h*a(2,1,N-0); M[8][8] = +3.0-2.0*h*a(2,2,N-0); c[8] = 2.0*h*b(2,N-0);

//    for (unsigned int i=0; i<9; i++)
//    {
//        printf("%d %14.10f %14.10f\n", i, c[i], M[i][0]*rx.at(0,N-2)+M[i][1]*rx.at(1,N-2)+M[i][2]*rx.at(2,N-2)+
//                M[i][3]*rx.at(0,N-1)+M[i][4]*rx.at(1,N-1)+M[i][5]*rx.at(2,N-1)+
//                M[i][6]*rx.at(0,N-0)+M[i][7]*rx.at(1,N-0)+M[i][8]*rx.at(2,N-0));
//    }

//    printf("det %.10f\n", M.determinant());
    GaussianElimination(M, c, x);

    printf("x1: %14.10f %14.10f %14.10f\n", x[0], x[3], x[6]);
    printf("x1: %14.10f %14.10f %14.10f\n", fx(0,N-2), fx(0,N-1), fx(0,N-0));
    printf("x2: %14.10f %14.10f %14.10f\n", x[1], x[4], x[7]);
    printf("x2: %14.10f %14.10f %14.10f\n", fx(1,N-2), fx(1,N-1), fx(1,N-0));
    printf("x3: %14.10f %14.10f %14.10f\n", x[2], x[5], x[8]);
    printf("x3: %14.10f %14.10f %14.10f\n", fx(2,N-2), fx(2,N-1), fx(2,N-0));

    return;

//    M[0][0] = betta.at(N-1).at(0,0);
//    M[0][1] = betta.at(N-1).at(0,1);
//    M[0][2] = betta.at(N-1).at(0,2);
//    M[0][3] = betta.at(N-0).at(0,0);
//    M[0][4] = betta.at(N-0).at(0,1);
//    M[0][5] = betta.at(N-0).at(0,2);
//    c[0] = eta[0];

//    M[1][0] = betta.at(N-1).at(1,0);
//    M[1][1] = betta.at(N-1).at(1,1);
//    M[1][2] = betta.at(N-1).at(1,2);
//    M[1][3] = betta.at(N-0).at(1,0);
//    M[1][4] = betta.at(N-0).at(1,1);
//    M[1][5] = betta.at(N-0).at(1,2);
//    c[1] = eta[1];

//    M[2][0] = betta.at(N-1).at(2,0);
//    M[2][1] = betta.at(N-1).at(2,1);
//    M[2][2] = betta.at(N-1).at(2,2);
//    M[2][3] = betta.at(N-0).at(2,0);
//    M[2][4] = betta.at(N-0).at(2,1);
//    M[2][5] = betta.at(N-0).at(2,2);
//    c[2] = eta[2];

//    M[3][0] = 2.0*h*((3.0+2.0*h*a(0,0,N-2))*a(0,0,N-1) + (0.0+2.0*h*a(0,1,N-2))*a(1,0,N-1) + (0.0+2.0*h*a(0,2,N-2))*a(2,0,N-1))+4.0;
//    M[3][1] = 2.0*h*((3.0+2.0*h*a(0,0,N-2))*a(0,1,N-1) + (0.0+2.0*h*a(0,1,N-2))*a(1,1,N-1) + (0.0+2.0*h*a(0,2,N-2))*a(2,1,N-1))+0.0;
//    M[3][2] = 2.0*h*((3.0+2.0*h*a(0,0,N-2))*a(0,2,N-1) + (0.0+2.0*h*a(0,1,N-2))*a(1,2,N-1) + (0.0+2.0*h*a(0,2,N-2))*a(2,2,N-1))+0.0;
//    M[3][3] = -(4.0+2.0*h*a(0,0,N-2));
//    M[3][4] = -(0.0+2.0*h*a(0,1,N-2));
//    M[3][5] = -(0.0+2.0*h*a(0,2,N-2));
//    c[3] = 2.0*h*(b(0,N-2) - ((3.0+2.0*h*a(0,0,N-2))*b(0,N-1)+(0.0+2.0*h*a(0,1,N-2))*b(1,N-1)+(0.0+2.0*h*a(0,2,N-2))*b(2,N-1)));

//    M[4][0] = 2.0*h*((0.0+2.0*h*a(1,0,N-2))*a(0,0,N-1) + (3.0+2.0*h*a(1,1,N-2))*a(1,0,N-1) + (0.0+2.0*h*a(1,2,N-2))*a(2,0,N-1))+0.0;
//    M[4][1] = 2.0*h*((0.0+2.0*h*a(1,0,N-2))*a(0,1,N-1) + (3.0+2.0*h*a(1,1,N-2))*a(1,1,N-1) + (0.0+2.0*h*a(1,2,N-2)*a(2,1,N-1)))+4.0;
//    M[4][2] = 2.0*h*((0.0+2.0*h*a(1,0,N-2))*a(0,2,N-1) + (3.0+2.0*h*a(1,1,N-2))*a(1,2,N-1) + (0.0+2.0*h*a(1,2,N-2)*a(2,2,N-1)))+0.0;
//    M[4][3] = -(0.0+2.0*h*a(1,0,N-2));
//    M[4][4] = -(4.0+2.0*h*a(1,1,N-2));
//    M[4][5] = -(0.0+2.0*h*a(1,2,N-2));
//    c[4] = 2.0*h*(b(1,N-2) - ((0.0+2.0*h*a(1,0,N-2))*b(0,N-1)+(3.0+2.0*h*a(1,1,N-2))*b(1,N-1)+(0.0+2.0*h*a(1,2,N-2))*b(2,N-1)));

//    M[5][0] = 2.0*h*((0.0+2.0*h*a(2,0,N-2)*a(0,0,N-1)) + (0.0+2.0*h*a(2,1,N-2))*a(1,0,N-1) +(3.0+2.0*h*a(2,2,N-2))*a(2,0,N-1))+0.0;
//    M[5][1] = 2.0*h*((0.0+2.0*h*a(2,0,N-2)*a(0,1,N-1)) + (0.0+2.0*h*a(2,1,N-2))*a(1,1,N-1) +(3.0+2.0*h*a(2,2,N-2))*a(2,1,N-1))+0.0;
//    M[5][2] = 2.0*h*((0.0+2.0*h*a(2,0,N-2)*a(0,2,N-1)) + (0.0+2.0*h*a(2,1,N-2))*a(1,2,N-1) +(3.0+2.0*h*a(2,2,N-2))*a(2,2,N-1))+4.0;
//    M[5][3] = -(0.0+2.0*h*a(2,0,N-2));
//    M[5][4] = -(0.0+2.0*h*a(2,1,N-2));
//    M[5][5] = -(4.0+2.0*h*a(2,2,N-2));
//    c[5] = 2.0*h*(b(2,N-2) - ((0.0+2.0*h*a(2,0,N-2))*b(0,N-1)+(0.0+2.0*h*a(2,1,N-2))*b(1,N-1)+(3.0+2.0*h*a(2,2,N-2))*b(2,N-1)));

//    //    printf("det %.10f\n", M.determinant());

//    for (unsigned int i=0; i<6; i++)
//    {
//        printf("%d %14.10f %14.10f\n", i, c[i], M[i][0]*rx.at(0,N-1)+M[i][1]*rx.at(1,N-1)+M[i][2]*rx.at(2,N-1)+
//                M[i][3]*rx.at(0,N-0)+M[i][4]*rx.at(1,N-0)+M[i][5]*rx.at(2,N-0));
//    }

//    GaussianElimination(M, c, x);

//    printf("%14.10f %14.10f %14.10f %14.10f\n", x[0], x[3], fx(0,N-1), fx(0,N-0));
//    printf("%14.10f %14.10f %14.10f %14.10f\n", x[1], x[4], fx(1,N-1), fx(1,N-0));
//    printf("%14.10f %14.10f %14.10f %14.10f\n", x[2], x[5], fx(2,N-1), fx(2,N-0));

    //    for (unsigned int i=0; i<6; i++)
    //    {
    //        printf("%d %14.10f %14.10f\n", i, c[i], M[i][0]*x[0]+M[i][1]*x[1]+M[i][2]*x[2]+
    //                M[i][3]*x[3]+M[i][4]*x[4]+M[i][5]*x[6]);
    //        printf("%d %14.10f %14.10f\n", i, c[i], M[i][0]*fx(0,N-1)+M[i][1]*fx(1,N-1)+M[i][2]*fx(2,N-1)+
    //                M[i][3]*fx(0,N-0)+M[i][4]*fx(1,N-0)+M[i][5]*fx(2,N-0));
    //    }
}

void Example6::method1K4()
{
    std::vector<unsigned int> s;
    s.push_back(0);
    s.push_back((1*N)/3);
    s.push_back(N/2);
    s.push_back((2*N)/3);
    s.push_back(N);

    DoubleMatrix rx;
    rx.resize(n,N+1);
    for (unsigned int k=0; k<=N; k++)
    {
        rx.at(0,k) = fx(0,k);
        rx.at(1,k) = fx(1,k);
        rx.at(2,k) = fx(2,k);
    }

    /* initializing betta */
    std::vector<DoubleMatrix> betta;
    betta.resize(N+1);
    for (unsigned int i=0; i<=N; i++)
    {
        betta[i].resize(n,n,0.0);
    }

    DoubleVector eta;
    eta.resize(n,0.0);

    for (unsigned int i=0; i<s.size(); i++)
    {
        betta.at(s[i]).at(0,0) = (rand()%100)*0.1-5.0; betta.at(s[i]).at(0,1) = (rand()%100)*0.1-5.0; betta.at(s[i]).at(0,2) = (rand()%100)*0.1-5.0;
        betta.at(s[i]).at(1,0) = (rand()%100)*0.1-5.0; betta.at(s[i]).at(1,1) = (rand()%100)*0.1-5.0; betta.at(s[i]).at(1,2) = (rand()%100)*0.1-5.0;
        betta.at(s[i]).at(2,0) = (rand()%100)*0.1-5.0; betta.at(s[i]).at(2,1) = (rand()%100)*0.1-5.0; betta.at(s[i]).at(2,2) = (rand()%100)*0.1-5.0;

//        IPrinter::print(betta.at(s[i]),n,n);
//        IPrinter::printSeperatorLine();

        eta.at(0) = eta.at(0) + betta.at(s[i]).at(0,0)*rx.at(0,s[i]) + betta.at(s[i]).at(0,1)*rx.at(1,s[i]) + betta.at(s[i]).at(0,2)*rx.at(2,s[i]);
        eta.at(1) = eta.at(1) + betta.at(s[i]).at(1,0)*rx.at(0,s[i]) + betta.at(s[i]).at(1,1)*rx.at(1,s[i]) + betta.at(s[i]).at(1,2)*rx.at(2,s[i]);
        eta.at(2) = eta.at(2) + betta.at(s[i]).at(2,0)*rx.at(0,s[i]) + betta.at(s[i]).at(2,1)*rx.at(1,s[i]) + betta.at(s[i]).at(2,2)*rx.at(2,s[i]);
    }

    unsigned int p = 15;
    DoubleMatrix M(p, p);
    DoubleVector c(p);
    DoubleVector x(p);

    for (unsigned int k=0; k<=N-5; k++)
    {
        DoubleMatrix d0 = betta[k+0];
        DoubleMatrix d1 = betta[k+1];
        DoubleMatrix d2 = betta[k+2];
        DoubleMatrix d3 = betta[k+3];
        DoubleMatrix d4 = betta[k+4];

        /************************************************** betta k+1 **************************************************/
        /* first row */
        betta[k+1].at(0,0) = +8.0*d0.at(0,0) + d1.at(0,0);
        betta[k+1].at(0,1) = +8.0*d0.at(0,1) + d1.at(0,1);
        betta[k+1].at(0,2) = +8.0*d0.at(0,2) + d1.at(0,2);

        /* second row */
        betta[k+1].at(1,0) = +8.0*d0.at(1,0) + d1.at(1,0);
        betta[k+1].at(1,1) = +8.0*d0.at(1,1) + d1.at(1,1);
        betta[k+1].at(1,2) = +8.0*d0.at(1,2) + d1.at(1,2);

        /* third row */
        betta[k+1].at(2,0) = +8.0*d0.at(2,0) + d1.at(2,0);
        betta[k+1].at(2,1) = +8.0*d0.at(2,1) + d1.at(2,1);
        betta[k+1].at(2,2) = +8.0*d0.at(2,2) + d1.at(2,2);

        /************************************************** betta k+2 **************************************************/
        /* first row */
        betta[k+2].at(0,0) = 12.0*h*(d0.at(0,0)*a(0,0,k+2) + d0.at(0,1)*a(1,0,k+2) + d0.at(0,2)*a(2,0,k+2)) + d2.at(0,0);
        betta[k+2].at(0,1) = 12.0*h*(d0.at(0,0)*a(0,1,k+2) + d0.at(0,1)*a(1,1,k+2) + d0.at(0,2)*a(2,1,k+2)) + d2.at(0,1);
        betta[k+2].at(0,2) = 12.0*h*(d0.at(0,0)*a(0,2,k+2) + d0.at(0,1)*a(1,2,k+2) + d0.at(0,2)*a(2,2,k+2)) + d2.at(0,2);

        /* second row */
        betta[k+2].at(1,0) = 12.0*h*(d0.at(1,0)*a(0,0,k+2) + d0.at(1,1)*a(1,0,k+2) + d0.at(1,2)*a(2,0,k+2)) + d2.at(1,0);
        betta[k+2].at(1,1) = 12.0*h*(d0.at(1,0)*a(0,1,k+2) + d0.at(1,1)*a(1,1,k+2) + d0.at(1,2)*a(2,1,k+2)) + d2.at(1,1);
        betta[k+2].at(1,2) = 12.0*h*(d0.at(1,0)*a(0,2,k+2) + d0.at(1,1)*a(1,2,k+2) + d0.at(1,2)*a(2,2,k+2)) + d2.at(1,2);

        /* third row */
        betta[k+2].at(2,0) = 12.0*h*(d0.at(2,0)*a(0,0,k+2) + d0.at(2,1)*a(1,0,k+2) + d0.at(2,2)*a(2,0,k+2)) + d2.at(2,0);
        betta[k+2].at(2,1) = 12.0*h*(d0.at(2,0)*a(0,1,k+2) + d0.at(2,1)*a(1,1,k+2) + d0.at(2,2)*a(2,1,k+2)) + d2.at(2,1);
        betta[k+2].at(2,2) = 12.0*h*(d0.at(2,0)*a(0,2,k+2) + d0.at(2,1)*a(1,2,k+2) + d0.at(2,2)*a(2,2,k+2)) + d2.at(2,2);

        /************************************************** betta k+3 **************************************************/
        /* first row */
        betta[k+3].at(0,0) = -8.0*d0.at(0,0) + d3.at(0,0);
        betta[k+3].at(0,1) = -8.0*d0.at(0,1) + d3.at(0,1);
        betta[k+3].at(0,2) = -8.0*d0.at(0,2) + d3.at(0,2);

        /* second row */
        betta[k+3].at(1,0) = -8.0*d0.at(1,0) + d3.at(1,0);
        betta[k+3].at(1,1) = -8.0*d0.at(1,1) + d3.at(1,1);
        betta[k+3].at(1,2) = -8.0*d0.at(1,2) + d3.at(1,2);

        /* third row */
        betta[k+3].at(2,0) = -8.0*d0.at(2,0) + d3.at(2,0);
        betta[k+3].at(2,1) = -8.0*d0.at(2,1) + d3.at(2,1);
        betta[k+3].at(2,2) = -8.0*d0.at(2,2) + d3.at(2,2);

        /************************************************** betta k+4 **************************************************/
        /* first row */
        betta[k+4].at(0,0) = d0.at(0,0) + d4.at(0,0);
        betta[k+4].at(0,1) = d0.at(0,1) + d4.at(0,1);
        betta[k+4].at(0,2) = d0.at(0,2) + d4.at(0,2);

        /* second row */
        betta[k+4].at(1,0) = d0.at(1,0) + d4.at(1,0);
        betta[k+4].at(1,1) = d0.at(1,1) + d4.at(1,1);
        betta[k+4].at(1,2) = d0.at(1,2) + d4.at(1,2);

        /* third row */
        betta[k+4].at(2,0) = d0.at(2,0) + d4.at(2,0);
        betta[k+4].at(2,1) = d0.at(2,1) + d4.at(2,1);
        betta[k+4].at(2,2) = d0.at(2,2) + d4.at(2,2);

        /***************************************************** eta ****************************************************/
        eta.at(0) = eta.at(0) - 12.0*h*(d0.at(0,0)*b(0,k+2) + d0.at(0,1)*b(1,k+2) + d0.at(0,2)*b(2,k+2));
        eta.at(1) = eta.at(1) - 12.0*h*(d0.at(1,0)*b(0,k+2) + d0.at(1,1)*b(1,k+2) + d0.at(1,2)*b(2,k+2));
        eta.at(2) = eta.at(2) - 12.0*h*(d0.at(2,0)*b(0,k+2) + d0.at(2,1)*b(1,k+2) + d0.at(2,2)*b(2,k+2));
    }

//    for (unsigned int i=0; i<=N; i++)
//    {
//        IPrinter::print(betta.at(i),n,n);
//        IPrinter::printSeperatorLine();
//    }

    M[0][0]  = betta.at(N-4).at(0,0);   M[0][1]  = betta.at(N-4).at(0,1);  M[0][2]  = betta.at(N-4).at(0,2);
    M[0][3]  = betta.at(N-3).at(0,0);   M[0][4]  = betta.at(N-3).at(0,1);  M[0][5]  = betta.at(N-3).at(0,2);
    M[0][6]  = betta.at(N-2).at(0,0);   M[0][7]  = betta.at(N-2).at(0,1);  M[0][8]  = betta.at(N-2).at(0,2);
    M[0][9]  = betta.at(N-1).at(0,0);   M[0][10] = betta.at(N-1).at(0,1);  M[0][11] = betta.at(N-1).at(0,2);
    M[0][12] = betta.at(N-0).at(0,0);   M[0][13] = betta.at(N-0).at(0,1);  M[0][14] = betta.at(N-0).at(0,2);
    c[0] = eta[0];

    M[1][0]  = betta.at(N-4).at(1,0);   M[1][1]  = betta.at(N-4).at(1,1);  M[1][2]  = betta.at(N-4).at(1,2);
    M[1][3]  = betta.at(N-3).at(1,0);   M[1][4]  = betta.at(N-3).at(1,1);  M[1][5]  = betta.at(N-3).at(1,2);
    M[1][6]  = betta.at(N-2).at(1,0);   M[1][7]  = betta.at(N-2).at(1,1);  M[1][8]  = betta.at(N-2).at(1,2);
    M[1][9]  = betta.at(N-1).at(1,0);   M[1][10] = betta.at(N-1).at(1,1);  M[1][11] = betta.at(N-1).at(1,2);
    M[1][12] = betta.at(N-0).at(1,0);   M[1][13] = betta.at(N-0).at(1,1);  M[1][14] = betta.at(N-0).at(1,2);
    c[1] = eta[1];

    M[2][0]  = betta.at(N-4).at(2,0);   M[2][1]  = betta.at(N-4).at(2,1);  M[2][2]  = betta.at(N-4).at(2,2);
    M[2][3]  = betta.at(N-3).at(2,0);   M[2][4]  = betta.at(N-3).at(2,1);  M[2][5]  = betta.at(N-3).at(2,2);
    M[2][6]  = betta.at(N-2).at(2,0);   M[2][7]  = betta.at(N-2).at(2,1);  M[2][8]  = betta.at(N-2).at(2,2);
    M[2][9]  = betta.at(N-1).at(2,0);   M[2][10] = betta.at(N-1).at(2,1);  M[2][11] = betta.at(N-1).at(2,2);
    M[2][12] = betta.at(N-0).at(2,0);   M[2][13] = betta.at(N-0).at(2,1);  M[2][14] = betta.at(N-0).at(2,2);
    c[2] = eta[2];

    /////////////////////////////////////////////////////////////////////////////////////////////////////////
    M[3][0]  = -25.0-12.0*h*a(0,0,N-4); M[3][1]  = +0.0-12.0*h*a(0,1,N-4);  M[3][2]  = +0.0-12.0*h*a(0,2,N-4);
    M[3][3]  = +48.0;                   M[3][4]  = +0.0;                    M[3][5]  = +0.0;
    M[3][6]  = -36.0;                   M[3][7]  = +0.0;                    M[3][8]  = +0.0;
    M[3][9]  = +16.0;                   M[3][10] = +0.0;                    M[3][11] = +0.0;
    M[3][12] = -3.0;                    M[3][13] = +0.0;                    M[3][14] = +0.0;
    c[3] = 12.0*h*b(0,N-4);

    M[4][0]  = +0.0-12.0*h*a(1,0,N-4);  M[4][1]  = -25.0-12.0*h*a(1,1,N-4); M[4][2]  = +0.0-12.0*h*a(1,2,N-4);
    M[4][3]  = +0.0;                    M[4][4]  = +48.0;                   M[4][5]  = +0.0;
    M[4][6]  = +0.0;                    M[4][7]  = -36.0;                   M[4][8]  = +0.0;
    M[4][9]  = +0.0;                    M[4][10] = +16.0;                   M[4][11] = +0.0;
    M[4][12] = +0.0;                    M[4][13] = -3.0;                    M[4][14] = +0.0;
    c[4] = 12.0*h*b(1,N-4);

    M[5][0]  = +0.0-12.0*h*a(2,0,N-4);  M[5][1]  = +0.0-12.0*h*a(2,1,N-4);  M[5][2]  = -25.0-12.0*h*a(2,2,N-4);
    M[5][3]  = +0.0;                    M[5][4]  = +0.0;                    M[5][5]  = +48.0;
    M[5][6]  = +0.0;                    M[5][7]  = +0.0;                    M[5][8]  = -36.0;
    M[5][9]  = +0.0;                    M[5][10] = +0.0;                    M[5][11] = +16.0;
    M[5][12] = +0.0;                    M[5][13] = +0.0;                    M[5][14] = -3.0;
    c[5] = 12.0*h*b(2,N-4);

    /////////////////////////////////////////////////////////////////////////////////////////////////////////
    M[6][0]  = -3.0;                    M[6][1]  = +0.0;                     M[6][2]  = +0.0;
    M[6][3]  = -10.0-12.0*h*a(0,0,N-3); M[6][4]  = +0.0-12.0*h*a(0,1,N-3);   M[6][5]  = +0.0-12.0*h*a(0,2,N-3);
    M[6][6]  = +18.0;                   M[6][7]  = +0.0;                     M[6][8]  = +0.0;
    M[6][9]  = -6.0;                    M[6][10] = +0.0;                     M[6][11] = +0.0;
    M[6][12] = +1.0;                    M[6][13] = +0.0;                     M[6][14] = +0.0;
    c[6] = 12.0*h*b(0,N-3);

    M[7][0]  = +0.0;                    M[7][1]  = -3.0;                     M[7][2]  = +0.0;
    M[7][3]  = +0.0-12.0*h*a(1,0,N-3);  M[7][4]  = -10.0-12.0*h*a(1,1,N-3);  M[7][5]  = +0.0-12.0*h*a(1,2,N-3);
    M[7][6]  = +0.0;                    M[7][7]  = +18.0;                    M[7][8]  = +0.0;
    M[7][9]  = +0.0;                    M[7][10] = -6.0;                     M[7][11] = +0.0;
    M[7][12] = +0.0;                    M[7][13] = +1.0;                     M[7][14] = +0.0;
    c[7] = 12.0*h*b(1,N-3);

    M[8][0]  = +0.0;                    M[8][1]  = +0.0;                     M[8][2]  = -3.0;
    M[8][3]  = +0.0-12.0*h*a(2,0,N-3);  M[8][4]  = +0.0-12.0*h*a(2,1,N-3);   M[8][5]  = -10.0-12.0*h*a(2,2,N-3);
    M[8][6]  = +0.0;                    M[8][7]  = +0.0;                     M[8][8]  = +18.0;
    M[8][9]  = +0.0;                    M[8][10] = +0.0;                     M[8][11] = -6.0;
    M[8][12] = +0.0;                    M[8][13] = +0.0;                     M[8][14] = +1.0;
    c[8] = 12.0*h*b(2,N-3);

    /////////////////////////////////////////////////////////////////////////////////////////////////////////
    M[9][0]  = -1.0;                     M[9][1]  = +0.0;                      M[9][2]  = +0.0;
    M[9][3]  = +6.0;                     M[9][4]  = +0.0;                      M[9][5]  = +0.0;
    M[9][6]  = -18.0;                    M[9][7]  = +0.0;                      M[9][8]  = +0.0;
    M[9][9]  = +10.0-12.0*h*a(0,0,N-1);  M[9][10] = +0.0-12.0*h*a(0,1,N-1);    M[9][11] = +0.0-12.0*h*a(0,2,N-1);
    M[9][12] = +3.0;                     M[9][13] = +0.0;                      M[9][14] = +0.0;
    c[9] = 12.0*h*b(0,N-1);

    M[10][0]  = +0.0;                    M[10][1]  = -1.0;                     M[10][2]  = +0.0;
    M[10][3]  = +0.0;                    M[10][4]  = +6.0;                     M[10][5]  = +0.0;
    M[10][6]  = +0.0;                    M[10][7]  = -18.0;                    M[10][8]  = +0.0;
    M[10][9]  = +0.0-12.0*h*a(1,0,N-1);  M[10][10] = +10.0-12.0*h*a(1,1,N-1);  M[10][11] = +0.0-12.0*h*a(1,2,N-1);
    M[10][12] = +0.0;                    M[10][13] = +3.0;                     M[10][14] = +0.0;
    c[10] = 12.0*h*b(1,N-1);

    M[11][0]  = +0.0;                    M[11][1]  = +0.0;                     M[11][2]  = -1.0;
    M[11][3]  = +0.0;                    M[11][4]  = +0.0;                     M[11][5]  = +6.0;
    M[11][6]  = +0.0;                    M[11][7]  = +0.0;                     M[11][8]  = -18.0;
    M[11][9]  = +0.0-12.0*h*a(2,0,N-1);  M[11][10] = +0.0-12.0*h*a(2,1,N-1);   M[11][11] = +10.0-12.0*h*a(2,2,N-1);
    M[11][12] = +0.0;                    M[11][13] = +0.0;                     M[11][14] = +3.0;
    c[11] = 12.0*h*b(2,N-1);

    /////////////////////////////////////////////////////////////////////////////////////////////////////////
    M[12][0]  = +3.0;                    M[12][1]  = +0.0;                    M[12][2]  = +0.0;
    M[12][3]  = -16.0;                   M[12][4]  = +0.0;                    M[12][5]  = +0.0;
    M[12][6]  = +36.0;                   M[12][7]  = +0.0;                    M[12][8]  = +0.0;
    M[12][9]  = -48.0;                   M[12][10] = +0.0;                    M[12][11] = +0.0;
    M[12][12] = +25.0-12.0*h*a(0,0,N-0); M[12][13] = +0.0-12.0*h*a(0,1,N-0);  M[12][14] = +0.0-12.0*h*a(0,2,N-0);
    c[12] = 12.0*h*b(0,N-0);

    M[13][0]  = +0.0;                    M[13][1]  = +3.0;                    M[13][2]  = +0.0;
    M[13][3]  = +0.0;                    M[13][4]  = -16.0;                   M[13][5]  = +0.0;
    M[13][6]  = +0.0;                    M[13][7]  = +36.0;                   M[13][8]  = +0.0;
    M[13][9]  = +0.0;                    M[13][10] = -48.0;                   M[13][11] = +0.0;
    M[13][12] = +0.0-12.0*h*a(1,0,N-0);  M[13][13] = +25.0-12.0*h*a(1,1,N-0); M[13][14] = +0.0-12.0*h*a(1,2,N-0);
    c[13] = 12.0*h*b(1,N-0);

    M[14][0]  = +0.0;                    M[14][1]  = +0.0;                    M[14][2]  = +3.0;
    M[14][3]  = +0.0;                    M[14][4]  = +0.0;                    M[14][5]  = -16.0;
    M[14][6]  = +0.0;                    M[14][7]  = +0.0;                    M[14][8]  = +36.0;
    M[14][9]  = +0.0;                    M[14][10] = +0.0;                    M[14][11] = -48.0;
    M[14][12] = +0.0-12.0*h*a(2,0,N-0);  M[14][13] = +0.0-12.0*h*a(2,1,N-0);  M[14][14] = +25.0-12.0*h*a(2,2,N-0);
    c[14] = 12.0*h*b(2,N-0);

    for (unsigned int i=0; i<p; i++)
    {
        printf("%d %14.10f %14.10f\n", i, c[i],
               M[i][0]*rx.at(0,N-4) + M[i][1]*rx.at(1,N-4) + M[i][2]*rx.at(2,N-4)+
               M[i][3]*rx.at(0,N-3) + M[i][4]*rx.at(1,N-3) + M[i][5]*rx.at(2,N-3)+
               M[i][6]*rx.at(0,N-2) + M[i][7]*rx.at(1,N-2) + M[i][8]*rx.at(2,N-2)+
               M[i][9]*rx.at(0,N-1) + M[i][10]*rx.at(1,N-1)+ M[i][11]*rx.at(2,N-1)+
               M[i][12]*rx.at(0,N-0)+ M[i][13]*rx.at(1,N-0)+ M[i][14]*rx.at(2,N-0));
    }

    printf("det %.10f\n", M.determinant());
    GaussianElimination(M, c, x);

    puts("");
    printf("x1: %14.10f %14.10f %14.10f %14.10f %14.10f\n", x[0], x[3], x[6], x[9], x[12]);
    printf("x1: %14.10f %14.10f %14.10f %14.10f %14.10f\n", fx(0,N-4), fx(0,N-3), fx(0,N-2), fx(0,N-1), fx(0,N-0));
    puts("");
    printf("x2: %14.10f %14.10f %14.10f %14.10f %14.10f\n", x[1], x[4], x[7], x[10], x[13]);
    printf("x2: %14.10f %14.10f %14.10f %14.10f %14.10f\n", fx(1,N-4), fx(1,N-3), fx(1,N-2), fx(1,N-1), fx(1,N-0));
    puts("");
    printf("x3: %14.10f %14.10f %14.10f %14.10f %14.10f\n", x[2], x[5], x[8], x[11], x[14]);
    printf("x3: %14.10f %14.10f %14.10f %14.10f %14.10f\n", fx(2,N-4), fx(2,N-3), fx(2,N-2), fx(2,N-1), fx(2,N-0));
    puts("");

    for (unsigned int i=0; i<p; i++)
    {
        printf("%d %14.10f %14.10f\n", i, c[i],
               M[i][0]*x.at(0) + M[i][1]*x.at(1) + M[i][2]*x.at(2)+
               M[i][3]*x.at(3) + M[i][4]*x.at(4) + M[i][5]*x.at(5)+
               M[i][6]*x.at(6) + M[i][7]*x.at(7) + M[i][8]*x.at(8)+
               M[i][9]*x.at(9) + M[i][10]*x.at(10)+ M[i][11]*x.at(11)+
               M[i][12]*x.at(12)+ M[i][13]*x.at(13)+ M[i][14]*x.at(14));
    }

    return;

//    M[0][0] = betta.at(N-1).at(0,0);
//    M[0][1] = betta.at(N-1).at(0,1);
//    M[0][2] = betta.at(N-1).at(0,2);
//    M[0][3] = betta.at(N-0).at(0,0);
//    M[0][4] = betta.at(N-0).at(0,1);
//    M[0][5] = betta.at(N-0).at(0,2);
//    c[0] = eta[0];

//    M[1][0] = betta.at(N-1).at(1,0);
//    M[1][1] = betta.at(N-1).at(1,1);
//    M[1][2] = betta.at(N-1).at(1,2);
//    M[1][3] = betta.at(N-0).at(1,0);
//    M[1][4] = betta.at(N-0).at(1,1);
//    M[1][5] = betta.at(N-0).at(1,2);
//    c[1] = eta[1];

//    M[2][0] = betta.at(N-1).at(2,0);
//    M[2][1] = betta.at(N-1).at(2,1);
//    M[2][2] = betta.at(N-1).at(2,2);
//    M[2][3] = betta.at(N-0).at(2,0);
//    M[2][4] = betta.at(N-0).at(2,1);
//    M[2][5] = betta.at(N-0).at(2,2);
//    c[2] = eta[2];

//    M[3][0] = 2.0*h*((3.0+2.0*h*a(0,0,N-2))*a(0,0,N-1) + (0.0+2.0*h*a(0,1,N-2))*a(1,0,N-1) + (0.0+2.0*h*a(0,2,N-2))*a(2,0,N-1))+4.0;
//    M[3][1] = 2.0*h*((3.0+2.0*h*a(0,0,N-2))*a(0,1,N-1) + (0.0+2.0*h*a(0,1,N-2))*a(1,1,N-1) + (0.0+2.0*h*a(0,2,N-2))*a(2,1,N-1))+0.0;
//    M[3][2] = 2.0*h*((3.0+2.0*h*a(0,0,N-2))*a(0,2,N-1) + (0.0+2.0*h*a(0,1,N-2))*a(1,2,N-1) + (0.0+2.0*h*a(0,2,N-2))*a(2,2,N-1))+0.0;
//    M[3][3] = -(4.0+2.0*h*a(0,0,N-2));
//    M[3][4] = -(0.0+2.0*h*a(0,1,N-2));
//    M[3][5] = -(0.0+2.0*h*a(0,2,N-2));
//    c[3] = 2.0*h*(b(0,N-2) - ((3.0+2.0*h*a(0,0,N-2))*b(0,N-1)+(0.0+2.0*h*a(0,1,N-2))*b(1,N-1)+(0.0+2.0*h*a(0,2,N-2))*b(2,N-1)));

//    M[4][0] = 2.0*h*((0.0+2.0*h*a(1,0,N-2))*a(0,0,N-1) + (3.0+2.0*h*a(1,1,N-2))*a(1,0,N-1) + (0.0+2.0*h*a(1,2,N-2))*a(2,0,N-1))+0.0;
//    M[4][1] = 2.0*h*((0.0+2.0*h*a(1,0,N-2))*a(0,1,N-1) + (3.0+2.0*h*a(1,1,N-2))*a(1,1,N-1) + (0.0+2.0*h*a(1,2,N-2)*a(2,1,N-1)))+4.0;
//    M[4][2] = 2.0*h*((0.0+2.0*h*a(1,0,N-2))*a(0,2,N-1) + (3.0+2.0*h*a(1,1,N-2))*a(1,2,N-1) + (0.0+2.0*h*a(1,2,N-2)*a(2,2,N-1)))+0.0;
//    M[4][3] = -(0.0+2.0*h*a(1,0,N-2));
//    M[4][4] = -(4.0+2.0*h*a(1,1,N-2));
//    M[4][5] = -(0.0+2.0*h*a(1,2,N-2));
//    c[4] = 2.0*h*(b(1,N-2) - ((0.0+2.0*h*a(1,0,N-2))*b(0,N-1)+(3.0+2.0*h*a(1,1,N-2))*b(1,N-1)+(0.0+2.0*h*a(1,2,N-2))*b(2,N-1)));

//    M[5][0] = 2.0*h*((0.0+2.0*h*a(2,0,N-2)*a(0,0,N-1)) + (0.0+2.0*h*a(2,1,N-2))*a(1,0,N-1) +(3.0+2.0*h*a(2,2,N-2))*a(2,0,N-1))+0.0;
//    M[5][1] = 2.0*h*((0.0+2.0*h*a(2,0,N-2)*a(0,1,N-1)) + (0.0+2.0*h*a(2,1,N-2))*a(1,1,N-1) +(3.0+2.0*h*a(2,2,N-2))*a(2,1,N-1))+0.0;
//    M[5][2] = 2.0*h*((0.0+2.0*h*a(2,0,N-2)*a(0,2,N-1)) + (0.0+2.0*h*a(2,1,N-2))*a(1,2,N-1) +(3.0+2.0*h*a(2,2,N-2))*a(2,2,N-1))+4.0;
//    M[5][3] = -(0.0+2.0*h*a(2,0,N-2));
//    M[5][4] = -(0.0+2.0*h*a(2,1,N-2));
//    M[5][5] = -(4.0+2.0*h*a(2,2,N-2));
//    c[5] = 2.0*h*(b(2,N-2) - ((0.0+2.0*h*a(2,0,N-2))*b(0,N-1)+(0.0+2.0*h*a(2,1,N-2))*b(1,N-1)+(3.0+2.0*h*a(2,2,N-2))*b(2,N-1)));

//    //    printf("det %.10f\n", M.determinant());

//    for (unsigned int i=0; i<6; i++)
//    {
//        printf("%d %14.10f %14.10f\n", i, c[i], M[i][0]*rx.at(0,N-1)+M[i][1]*rx.at(1,N-1)+M[i][2]*rx.at(2,N-1)+
//                M[i][3]*rx.at(0,N-0)+M[i][4]*rx.at(1,N-0)+M[i][5]*rx.at(2,N-0));
//    }

//    GaussianElimination(M, c, x);

//    printf("%14.10f %14.10f %14.10f %14.10f\n", x[0], x[3], fx(0,N-1), fx(0,N-0));
//    printf("%14.10f %14.10f %14.10f %14.10f\n", x[1], x[4], fx(1,N-1), fx(1,N-0));
//    printf("%14.10f %14.10f %14.10f %14.10f\n", x[2], x[5], fx(2,N-1), fx(2,N-0));

    //    for (unsigned int i=0; i<6; i++)
    //    {
    //        printf("%d %14.10f %14.10f\n", i, c[i], M[i][0]*x[0]+M[i][1]*x[1]+M[i][2]*x[2]+
    //                M[i][3]*x[3]+M[i][4]*x[4]+M[i][5]*x[6]);
    //        printf("%d %14.10f %14.10f\n", i, c[i], M[i][0]*fx(0,N-1)+M[i][1]*fx(1,N-1)+M[i][2]*fx(2,N-1)+
    //                M[i][3]*fx(0,N-0)+M[i][4]*fx(1,N-0)+M[i][5]*fx(2,N-0));
    //    }
}
